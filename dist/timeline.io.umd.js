(()=>{var E=Object.defineProperty,I=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var M=(g,e,t)=>e in g?E(g,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[e]=t,v=(g,e)=>{for(var t in e||(e={}))x.call(e,t)&&M(g,t,e[t]);if(L)for(var t of L(e))N.call(e,t)&&M(g,t,e[t]);return g},D=(g,e)=>I(g,H(e));var T=class{constructor(e,t,s,r){if(!e)throw new Error("Events argument is empty. Please add Array of events | DOM element | selector as first arg");if(typeof e=="string"){let c=document.querySelector(e);if(!c)throw new Error(`Selector could not be found [${e}]`);this.element=c}e instanceof HTMLElement&&(this.element=e),this.options=v({labelCount:5,zoomSpeed:.025,dragSpeed:.001,startDate:"-100y",endDate:"10y",timelineStartDate:"-1000y",timelineEndDate:"1000y",minZoom:1,maxZoom:1e11,position:"bottom",expandRatio:80,eventHeight:5},s),this.timelineStart=this.parseDate(this.options.timelineStartDate),this.timelineEnd=this.parseDate(this.options.timelineEndDate);let l=this.parseDate(this.options.startDate),m=this.parseDate(this.options.endDate);l.getTime()<this.timelineStart.getTime()&&(this.timelineStart=l),m.getTime()>this.timelineEnd.getTime()&&(this.timelineEnd=m);let d=m.getTime()-l.getTime();this.ratio=this.timelineDuration/d,this.pivot=(this.timelineStart.getTime()-l.getTime())/d;let u=[...Array.isArray(t)?t:[],...this.parseTimelineHTML(this.element)];this.events=[...this.parseEvents(u)],console.log(this.events),this.setupContainerHTML(),this.registerListeners(this.element),this.callback=r,this.update()}get timelineDuration(){return this.timelineEnd.getTime()-this.timelineStart.getTime()}get viewWidth(){var e;return((e=this.element)==null?void 0:e.offsetWidth)||0}get start(){return this.timelineStart.getTime()-this.duration*this.pivot}get end(){return this.start+this.duration}get duration(){return this.timelineDuration/this.ratio}get startDate(){return new Date(this.start)}get endDate(){return new Date(this.end)}getLeftRatio(e){return(e-this.startDate.getTime())/this.duration}setRatio(e,t){let s=this.ratio-t;return e===1&&s<=this.options.minZoom||e===-1&&s>=this.options.maxZoom?!1:(this.ratio=s,!0)}setPivot(e){let t=this.pivot+e;t>=0&&(t=0),t+this.ratio<=1&&(t=1-this.ratio),this.pivot=t}zoom(e,t){let s=this.options.zoomSpeed*this.ratio,r=e*s,d=((t||0)/this.viewWidth-this.pivot)/this.ratio*r;this.setRatio(e,r)&&this.setPivot(d),this.update()}move(e){this.setPivot(e),this.update()}registerListeners(e){let t=this,s=function(){t.update()};window.removeEventListener("resize",s),window.addEventListener("resize",s,{passive:!0});let r=function(n){var i=Math.sign(n.deltaY);let h=(n.target.attributes.starttime?t.getLeftRatio(n.target.attributes.starttime):0)*t.element.getBoundingClientRect().width+n.offsetX;t.zoom(i,h)};e.removeEventListener("wheel",r),e.addEventListener("wheel",r,{passive:!0});let l,m,d=!1,u=!0,c=function(n){d=!0,l=n.pageX,m=n.pageY};e.removeEventListener("mousedown",c),e.addEventListener("mousedown",c,{passive:!0});let b=function(n){if(!d||!u)return;u=!1;let i=(n.pageX-l)*t.options.dragSpeed;t.move(i),l=n.pageX,m=n.pageY,setTimeout(()=>u=!0,10)};e.removeEventListener("mousemove",b),e.addEventListener("mousemove",b,{passive:!0});let o=function(){d=!1};e.removeEventListener("mouseup",o),document.addEventListener("mouseup",o,{passive:!0})}setupEventsHTML(e,t=null){let s=document.createDocumentFragment();return e.forEach((r,l)=>{try{let m=r.startdate.getTime(),d=r.enddate.getTime(),u=this.getLeftRatio(m);if(m>this.endDate.getTime()||d<this.startDate.getTime())return;let c=r.height+(r.height-1)*.5,b=(r.level-1+(t?t.level:1)-1)*1.5,o=document.createElement("div"),i=Number(r.duration)*6e4/this.duration*100,a=i>this.options.expandRatio,h=240-Math.pow(10,r.depth);a&&r.events.length?(s.append(this.setupEventsHTML(r.events,r)),o.style.left=u*100+"%",o.style.width=i+"%"):(o.style.left=u*100+"%",o.style.width=i+"%"),o.style.minHeight=`${c*this.options.eventHeight}px`,o.style.bottom=`${b*this.options.eventHeight}px`,o.style.position="absolute",o.style.minWidth="5px",o.style.borderRadius="5px",o.style.boxShadow="inset #666 0px 0px 1px 0.5px",o.style.backgroundColor=`rgb(${h},${h},${h})`,o.style.zIndex=r.depth.toString(),o.title=r.title,o.className="timelineEventGenerated",o.attributes.starttime=m,s.appendChild(o)}catch(m){console.error(m,"timelineEvent",r)}}),s}setupContainerHTML(){this.element.style.position="relative",this.element.style.overflow="hidden",this.element.style.minHeight="3rem",this.element.style.zIndex="0";let e=this.element.querySelector(".timelineLabelContainer");switch(this.labelContainer=e||document.createElement("div"),e||this.element.appendChild(this.labelContainer),this.labelContainer.className="timelineLabelContainer",this.labelContainer.style.width="100%",this.labelContainer.style.height="3rem",this.labelContainer.style.textAlign="center",this.labelContainer.style.position="absolute",this.labelContainer.style.zIndex="-9",this.options.position){case"top":this.labelContainer.style.top="0";break;case"center":this.labelContainer.style.top="50%",this.labelContainer.style.transform="translate(0, calc(-50%))";break;default:this.labelContainer.style.bottom="0"}let t=this.element.querySelector(".timelineDividerContainer");this.dividerContainer=t||document.createElement("div"),t||this.element.appendChild(this.dividerContainer),this.dividerContainer.className="timelineDividerContainer",this.dividerContainer.style.width="100%",this.dividerContainer.style.height="100%",this.dividerContainer.style.position="absolute",this.dividerContainer.style.zIndex="-10";let s=this.element.querySelector(".timelineEventsContainer");this.eventsContainer=s||document.createElement("div"),s||this.element.appendChild(this.eventsContainer),this.eventsContainer.className="timelineEventsContainer",this.eventsContainer.style.position="absolute",this.eventsContainer.style.bottom="4rem",this.eventsContainer.style.width="100%",this.eventsContainer.style.zIndex="-1"}format(e){let t=new Date(e);return this.duration<1440*6e5*4?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(t):this.duration<10080*6e5*6?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric"}).format(t):this.duration<43829.0639*6e5*18?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short"}).format(t):t.getFullYear().toString()}update(){if(!this.element)return;let e=Math.floor(this.ratio),t=Math.pow(2,Math.floor(Math.log2(e))),s=1/(this.options.labelCount+1),r=this.start-this.timelineStart.getTime(),m=this.timelineDuration*s/t,u=Math.floor(r/m)*m,c=document.createDocumentFragment(),b=document.createDocumentFragment();for(let i=0;i<this.options.labelCount+2;i++){let a=(i+1)*m+this.timelineStart.getTime()+u-m,h=a+m/2,w=this.getLeftRatio(a)*100,C=this.getLeftRatio(h)*100,p=document.createElement("div");p.className="timelineLabel",p.style.left=w+"%",p.style.top="50%",p.style.transform="translate(calc(-50%), calc(-50%))",p.style.textAlign="center",p.style.position="absolute",p.style.zIndex="-1",p.style.width=s*100+"%",p.innerHTML=this.format(a),c.appendChild(p);let f=document.createElement("div");f.className="timelineDivider",f.style.left=C+"%",f.style.textAlign="center",f.style.position="absolute",f.style.height="100%",f.style.zIndex="-10",f.innerHTML="",b.appendChild(f)}this.labelContainer.innerHTML="",this.labelContainer.appendChild(c),this.dividerContainer.innerHTML="",this.dividerContainer.appendChild(b);let o=this.setupEventsHTML(this.events);this.eventsContainer.innerHTML="",this.eventsContainer.appendChild(o);let n=new CustomEvent("update",{detail:this.toJSON(),bubbles:!0,cancelable:!0,composed:!1});this.element.dispatchEvent(n),this.callback&&this.callback(this)}parseDate(e){if(e===void 0)return new Date;if(Array.isArray(e)){let t=e;if(t.length===0)throw new Error("argument Array cannot be empty");if(!t.every(r=>typeof r=="number"))throw new Error("input Array must contain only numbers");return this.parseDateArray(t)}if(typeof e=="object"&&e.constructor.name==="Date")return e;if(typeof e=="string")return this.parseDateString(e);if(typeof e=="number")return new Date(e)}parseDateArray(e){let t=new Date;return t.setFullYear(e[0]||t.getFullYear()),t.setDate(e[2]?e[2]:1),t.setMonth(e[1]?e[1]-1:0),t.setHours(e[3]?e[3]:0),t.setMinutes(e[4]?e[4]:0),t.setSeconds(0),t}parseDateString(e){switch(e){case"now":return new Date;case"max":return new Date(864e13);case"min":return new Date(-864e13);default:let t=Number(e.replace(/y$/,""));if(!isNaN(t))return new Date(Date.now()+31556926*1e3*t);let s=new Date("0001-01-01"),r=Number(e.replace(/bc$/,""));if(!isNaN(r))return new Date(s.getTime()-31556926*1e3*r);let l=Number(e.replace(/ad$/,""));return isNaN(l)?new Date(e):new Date(s.getTime()+31556926*1e3*l)}}parseEvents(e,t=null){if(!Array.isArray(e))return console.warn("Events object is not an array",e),[];let r=e.reduce((n,i)=>{i.depth=t?t.depth+1:0;let a=i.events?[...this.parseEvents(i.events,i)]:[];if(!i.startdate&&!a.length)return console.warn("Missing startdate on event",i,e),n;let h=i.startdate?a.length?this.parseDate(Math.min(this.parseDate(i.startdate).getTime(),this.parseDate(a[0].startdate).getTime())):this.parseDate(i.startdate):a[0].startdate,y=i.enddate?this.parseDate(i.enddate):i.duration&&!isNaN(Number(i.duration))?new Date(h.getTime()+Number(i.duration)*6e4):a.length?a[a.length-1].enddate:h,w=h.getTime(),C=(y.getTime()-w)/6e4;return n.push(D(v({duration:C},i),{startdate:h,enddate:y,events:a,height:a.length?Math.max.apply(1,a.map(p=>p.level)):1})),n},[]).sort((n,i)=>n.startdate.getTime()-i.startdate.getTime()),l={1:{height:0,time:Number.MIN_SAFE_INTEGER}},m=n=>{let i=0;for(let a in l)if(i=Number(a),n.startdate.getTime()>l[a].time){for(let h=0;h<n.height;h++)l[(i+h).toString()]={height:n.height,time:n.enddate.getTime()};return i}i++;for(let a=0;a<n.height;a++)l[(i+a).toString()]={height:n.height,time:n.enddate.getTime()};return i},d={1:{height:0,time:Number.MIN_SAFE_INTEGER}},u=n=>{let i=0;for(let a in d)if(i=Number(a),n.startdate.getTime()>d[a].time)return d[i.toString()]={height:n.height,time:n.enddate.getTime()},i;return i++,d[i.toString()]={height:n.height,time:n.enddate.getTime()},i},c=r.map((n,i)=>D(v({},n),{level:m(n),step:u(n)})),b=n=>{let i=1;return i=n.duration/this.timelineDuration*n.height,i};return c.map((n,i)=>D(v({},n),{score:b(n)}))}parseTimelineHTML(e){let t=[],s=e.querySelectorAll(".timelineEvent");return s&&s.forEach(r=>{try{t.push(D(v({},r.attributes),{events:this.parseTimelineHTML(r)}))}catch(l){console.error(l,"timelineEvent")}}),t}toJSON(){return{options:this.options,startDate:this.startDate,endDate:this.endDate,duration:this.duration,ratio:this.ratio,pivot:this.pivot}}};window.Timeline=T;})();
